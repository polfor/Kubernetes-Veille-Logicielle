<!DOCTYPE html><!--  This site was created in Webflow. http://www.webflow.com  -->
<!--  Last Published: Mon Jan 31 2022 18:22:48 GMT+0000 (Coordinated Universal Time)  -->
<html data-wf-page="61f7c29e30d06c41dad1bb82" data-wf-site="61f7bcaf15e4996f07f19373">
<head>
  <meta charset="utf-8">
  <title>Code</title>
  <meta content="Code" property="og:title">
  <meta content="Code" property="twitter:title">
  <meta content="width=device-width, initial-scale=1" name="viewport">
  <meta content="Webflow" name="generator">
  <link href="css/normalize.css" rel="stylesheet" type="text/css">
  <link href="css/webflow.css" rel="stylesheet" type="text/css">
  <link href="css/veille-logicielle.webflow.css" rel="stylesheet" type="text/css">
  <script src="https://ajax.googleapis.com/ajax/libs/webfont/1.6.26/webfont.js" type="text/javascript"></script>
  <script type="text/javascript">WebFont.load({  google: {    families: ["Red Hat Display:300,regular,500,600,700,800,900,300italic,italic,500italic,600italic,700italic,800italic,900italic"]  }});</script>
  <!-- [if lt IE 9]><script src="https://cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv.min.js" type="text/javascript"></script><![endif] -->
  <script type="text/javascript">!function(o,c){var n=c.documentElement,t=" w-mod-";n.className+=t+"js",("ontouchstart"in o||o.DocumentTouch&&c instanceof DocumentTouch)&&(n.className+=t+"touch")}(window,document);</script>
  <link href="images/favicon.ico" rel="shortcut icon" type="image/x-icon">
  <link href="images/webclip.png" rel="apple-touch-icon">
</head>
<body>
  <div class="section">
    <div class="container is--nav">
      <div class="nav-links__wrapper">
        <div class="nav-links">
          <a href="index.html" class="buttons">Accueil</a>
          <a href="code.html" aria-current="page" class="buttons w--current">Exemple de code</a>
        </div>
        <div class="nav-links">
          <a href="https://www.kubernetes.io/fr/" target="_blank" class="w-inline-block"><img src="images/Logo-Kub.svg" loading="lazy" alt="" class="logo-kub"></a>
        </div>
      </div>
      <div class="separator"></div>
    </div>
  </div>
  <div class="section">
    <div class="container is--hero">
      <h1>Exemple : un simple serveur Apache tournant sur Google Kubernetes Engine</h1>
      <p class="code-subtitle">Petit rappel,  GKE est le système Kubernetes de la plateforme Google Cloud. Le cluster GKE est composé d’instances de Machines Virtuelles exécutant Kubernetes.</p>
    </div>
  </div>
  <div class="section">
    <div class="container"></div>
  </div>
  <div class="section">
    <div id="conteneurs" class="container">
      <div class="section-title__wrapper">
        <h2>Première étape : Setup le projet Google Cloud</h2><img src="images/downarrow.svg" loading="lazy" alt="" class="section-arrow">
      </div>
      <div class="separator"></div>
      <div class="section-wrapper">
        <div class="section-content is--code">
          <h3>A/ Le compte</h3>
          <p>Il vous faudra créer un compte Google (si vous n&#x27;en avez pas déjà un). Ensuite, il faut démarrer l&#x27;essai gratuit.</p>
          <p>L&#x27;essai activé, allez sur la <a href="https://console.cloud.google.com/home/dashboard" target="_blank" class="in-text__link">Dashboard</a> pour créer un nouveau projet.<br></p>
          <p>Pensez à noter le Project ID, il servira pour la suite du projet</p>
        </div>
        <div class="image-container"><img src="images/1.png" loading="lazy" alt=""></div>
      </div>
      <div class="section-wrapper is--upside-down">
        <div class="image-container is--upside-down">
          <div data-delay="4000" data-animation="slide" class="screen-slider w-slider" data-autoplay="false" data-easing="ease" data-hide-arrows="false" data-disable-swipe="false" data-autoplay-limit="0" data-nav-spacing="3" data-duration="500" data-infinite="true">
            <div class="slider-mask w-slider-mask">
              <div class="w-slide">
                <div class="slide-container"><img src="images/2.png" loading="lazy" sizes="(max-width: 479px) 66vw, 230.41665649414062px" srcset="images/2-p-500.png 500w, images/2.png 669w" alt="" class="slider-image"></div>
              </div>
              <div class="w-slide">
                <div class="slide-container"><img src="images/3.png" loading="lazy" sizes="66vw" srcset="images/3-p-500.png 500w, images/3.png 729w" alt="" class="slider-image"></div>
              </div>
              <div class="w-slide">
                <div class="slide-container"><img src="images/4.png" loading="lazy" sizes="66vw" srcset="images/4-p-500.png 500w, images/4.png 958w" alt="" class="slider-image"></div>
              </div>
              <div class="w-slide">
                <div class="slide-container"><img src="images/5.png" loading="lazy" sizes="(max-width: 991px) 66vw, 581.1197509765625px" srcset="images/5-p-500.png 500w, images/5.png 585w" alt="" class="slider-image"></div>
              </div>
            </div>
            <div class="w-slider-arrow-left">
              <div class="w-icon-slider-left"></div>
            </div>
            <div class="w-slider-arrow-right">
              <div class="w-icon-slider-right"></div>
            </div>
            <div class="w-slider-nav w-round"></div>
          </div>
        </div>
        <div class="section-content is--code is--upside-down">
          <h3>B/ Préparation du projet</h3>
          <p>Nous aurons besoin de deux APIs fournies par Google Cloud : L&#x27;Artifact Registry et Google Kubernetes Engine</p>
          <p>Pour les activer, rendez vous dans <em>APIs and services </em>dans le volet de navigation, cliquez sur <em>Enable APIs and Services<br></em></p>
          <p>Cherchez Kubernetes et Artifact Registry, puis activez-les</p>
        </div>
      </div>
      <div class="section-wrapper is--upside-down">
        <div class="image-container is--upside-down">
          <div data-delay="4000" data-animation="slide" class="screen-slider w-slider" data-autoplay="false" data-easing="ease" data-hide-arrows="false" data-disable-swipe="false" data-autoplay-limit="0" data-nav-spacing="3" data-duration="500" data-infinite="true">
            <div class="slider-mask w-slider-mask">
              <div class="w-slide">
                <div class="slide-container"><img src="images/6.png" loading="lazy" sizes="66vw" srcset="images/6-p-500.png 500w, images/6.png 1012w" alt="" class="slider-image"></div>
              </div>
              <div class="w-slide">
                <div class="slide-container"><img src="images/7.png" loading="lazy" alt="" class="slider-image"></div>
              </div>
              <div class="w-slide">
                <div class="slide-container"><img src="images/8.png" loading="lazy" alt="" class="slider-image"></div>
              </div>
              <div class="w-slide">
                <div class="slide-container"><img src="images/9.png" loading="lazy" sizes="66vw" srcset="images/9-p-500.png 500w, images/9.png 1726w" alt="" class="slider-image"></div>
              </div>
            </div>
            <div class="w-slider-arrow-left">
              <div class="w-icon-slider-left"></div>
            </div>
            <div class="w-slider-arrow-right">
              <div class="w-icon-slider-right"></div>
            </div>
            <div class="w-slider-nav w-round"></div>
          </div>
        </div>
        <div class="section-content is--code is--upside-down">
          <h3>C/ Préparation de notre environnement de travail</h3>
          <p>Tout d&#x27;abord, nous devons accéder à la console Google Cloud</p>
          <p>Ensuite, définissons une variable <em>$PROJECT_ID </em>qui simplifiera nos commandes plus tard (grâce à l&#x27;ID du projet)<em><br></em></p>
          <div class="copy-embed w-embed"><button class="copy-button" onclick="navigator.clipboard.writeText('export PROJECT_ID=hello-kubernetes-veille')">Copier la commande</button></div>
          <p>Puis fournissons cette variable à l&#x27;ensemble de commandes gcloud pour qu&#x27;il identifie notre projet.</p>
          <div class="copy-embed w-embed"><button class="copy-button" onclick="navigator.clipboard.writeText('gcloud config set project $PROJECT_ID')">Copier la commande</button></div>
          <p>Enfin, créons le repository Artifact Registry, qui stockera notre image pour la fournir à GKE.<br><em>A partir de ce moment, je vais utiliser des commandes avec une &quot;région&quot;. Celles qui sont accessibles grâce à </em><span class="redspan"><em>gcloud artifacts locations list</em></span></p>
          <div class="copy-embed w-embed"><button class="copy-button" onclick="navigator.clipboard.writeText('gcloud artifacts repositories create hello-veille \ --repository-format=docker \ --location=europe-west1 \ --description=&quot;Repository Hello Kubernetes !&quot;')">Copier la commande</button></div>
        </div>
      </div>
    </div>
  </div>
  <div class="section">
    <div id="conteneurs" class="container">
      <div class="section-title__wrapper">
        <h2>Deuxième étape : Création et gestion de notre cluster GKE</h2><img src="images/downarrow.svg" loading="lazy" alt="" class="section-arrow">
      </div>
      <div class="separator"></div>
      <div class="section-wrapper is--upside-down">
        <div class="image-container is--upside-down">
          <div data-delay="4000" data-animation="slide" class="screen-slider w-slider" data-autoplay="false" data-easing="ease" data-hide-arrows="false" data-disable-swipe="false" data-autoplay-limit="0" data-nav-spacing="3" data-duration="500" data-infinite="true">
            <div class="slider-mask w-slider-mask">
              <div class="w-slide">
                <div class="slide-container"><img src="images/10.png" loading="lazy" sizes="66vw" srcset="images/10-p-500.png 500w, images/10-p-800.png 800w, images/10.png 1244w" alt="" class="slider-image"></div>
              </div>
              <div class="w-slide">
                <div class="slide-container"><img src="images/11.png" loading="lazy" sizes="66vw" srcset="images/11-p-500.png 500w, images/11-p-800.png 800w, images/11-p-1080.png 1080w, images/11.png 1792w" alt="" class="slider-image"></div>
              </div>
              <div class="w-slide">
                <div class="slide-container"><img src="images/12.png" loading="lazy" sizes="66vw" srcset="images/12-p-500.png 500w, images/12-p-800.png 800w, images/12-p-1080.png 1080w, images/12.png 1717w" alt="" class="slider-image"></div>
              </div>
            </div>
            <div class="w-slider-arrow-left">
              <div class="w-icon-slider-left"></div>
            </div>
            <div class="w-slider-arrow-right">
              <div class="w-icon-slider-right"></div>
            </div>
            <div class="w-slider-nav w-round"></div>
          </div>
        </div>
        <div class="section-content is--code is--upside-down">
          <h3>A/ L&#x27;image</h3>
          <p>Nous devons à présent créer l&#x27;image Docker qui sera utilisé par Kubernetes pour ses conteneurs. J&#x27;ai déjà <a href="https://github.com/polfor/hello-kubernetes" target="_blank" class="in-text__link light"><em>créé une image que vous pourrez cloner</em></a>.</p>
          <div class="copy-embed w-embed"><button class="copy-button" onclick="navigator.clipboard.writeText('git clone https://github.com/polfor/hello-kubernetes.git')">Copier la commande</button></div>
          <p>Rentrez dans le dossier ainsi créé, et demandez à Docker de build l&#x27;image et de la stocker dans l&#x27;environnement local. <em><br></em></p>
          <div class="copy-embed w-embed"><button class="copy-button" onclick="navigator.clipboard.writeText('docker build -t europe-west1-docker.pkg.dev/${PROJECT_ID}/hello-veille/veille-app:v1 .')">Copier la commande</button></div>
          <p>Nous devons à présent authentifier Docker auprès de notre Artifact Registry</p>
          <div class="copy-embed w-embed"><button class="copy-button" onclick="navigator.clipboard.writeText('gcloud auth configure-docker europe-west1-docker.pkg.dev')">Copier la commande</button></div>
          <p>Enfin, pushons notre image vers le Repository que nous avons créé auparavant.</p>
          <div class="copy-embed w-embed"><button class="copy-button" onclick="navigator.clipboard.writeText('docker push europe-west1-docker.pkg.dev/${PROJECT_ID}/hello-veille/veille-app:v1')">Copier la commande</button></div>
        </div>
      </div>
      <div class="section-wrapper is--upside-down">
        <div class="image-container is--upside-down">
          <div data-delay="4000" data-animation="slide" class="screen-slider w-slider" data-autoplay="false" data-easing="ease" data-hide-arrows="false" data-disable-swipe="false" data-autoplay-limit="0" data-nav-spacing="3" data-duration="500" data-infinite="true">
            <div class="slider-mask w-slider-mask">
              <div class="w-slide">
                <div class="slide-container"><img src="images/13.png" loading="lazy" alt="" class="slider-image"></div>
              </div>
              <div class="w-slide">
                <div class="slide-container"><img src="images/14.png" loading="lazy" sizes="66vw" srcset="images/14-p-500.png 500w, images/14-p-800.png 800w, images/14-p-1080.png 1080w, images/14.png 1897w" alt="" class="slider-image"></div>
              </div>
              <div class="w-slide">
                <div class="slide-container"><img src="images/15.png" loading="lazy" sizes="66vw" srcset="images/15-p-500.png 500w, images/15-p-800.png 800w, images/15.png 1699w" alt="" class="slider-image"></div>
              </div>
              <div class="w-slide">
                <div class="slide-container"><img src="images/16.png" loading="lazy" sizes="66vw" srcset="images/16-p-500.png 500w, images/16.png 1891w" alt="" class="slider-image"></div>
              </div>
            </div>
            <div class="w-slider-arrow-left">
              <div class="w-icon-slider-left"></div>
            </div>
            <div class="w-slider-arrow-right">
              <div class="w-icon-slider-right"></div>
            </div>
            <div class="w-slider-nav w-round"></div>
          </div>
        </div>
        <div class="section-content is--code is--upside-down">
          <h3>B/ Le cluster</h3>
          <p>Maintenant que notre image se trouve bien sur notre Repository, nous allons créer notre cluster GKE.<br>Tout d&#x27;abord nous devons sélectionner la zone d&#x27;exécution de notre cluster, le plus près du Repository sera le mieux. <br><em>Vous pouvez voie les zones disponibles avec</em><span class="redspan"><em> gcloud compute zones list</em></span><em><br></em></p>
          <div class="copy-embed w-embed"><button class="copy-button" onclick="navigator.clipboard.writeText('gcloud config set compute/zone europe-west6-c')">Copier la commande</button></div>
          <p>Ensuite, plus qu&#x27;à créer le cluster en lui-même ! (cela peut prendre jusqu&#x27;à quelques minutes)</p>
          <div class="copy-embed w-embed"><button class="copy-button" onclick="navigator.clipboard.writeText('gcloud container clusters create veille-cluster')">Copier la commande</button></div>
          <p>Pour s’assurer de la connexion au cluster nous pouvons utiliser <span class="redspan"><em>get-credentials</em></span></p>
          <div class="copy-embed w-embed"><button class="copy-button" onclick="navigator.clipboard.writeText('gcloud container clusters get-credentials veille-cluster --zone europe-west6-c')">Copier la commande</button></div>
          <p>Enfin, déployons notre application sur le custer à partir de l&#x27;image sur le Repository</p>
          <div class="copy-embed w-embed"><button class="copy-button" onclick="navigator.clipboard.writeText('kubectl create deployment veille-app --image=europe-west1-docker.pkg.dev/${PROJECT_ID}/hello-veille/veille-app:v1')">Copier la commande</button></div>
          <p>Voilà ! Notre application est bien déployée, mais elle est inaccessible car nous n&#x27;avons pas défini de service d&#x27;adressage</p>
        </div>
      </div>
    </div>
  </div>
  <div class="section">
    <div id="conteneurs" class="container">
      <div class="section-title__wrapper">
        <h2>Dernière étape : Exposons notre application au Web</h2><img src="images/downarrow.svg" loading="lazy" alt="" class="section-arrow">
      </div>
      <div class="separator"></div>
      <div class="section-wrapper is--upside-down">
        <div class="image-container is--upside-down">
          <div data-delay="4000" data-animation="slide" class="screen-slider w-slider" data-autoplay="false" data-easing="ease" data-hide-arrows="false" data-disable-swipe="false" data-autoplay-limit="0" data-nav-spacing="3" data-duration="500" data-infinite="true">
            <div class="slider-mask w-slider-mask">
              <div class="w-slide">
                <div class="slide-container"><img src="images/17.png" loading="lazy" sizes="(max-width: 2045px) 66vw, 1350px" srcset="images/17-p-500.png 500w, images/17-p-800.png 800w, images/17.png 1350w" alt="" class="slider-image"></div>
              </div>
              <div class="w-slide">
                <div class="slide-container"><img src="images/18.png" loading="lazy" sizes="(max-width: 2462px) 66vw, 1625px" srcset="images/18-p-500.png 500w, images/18-p-800.png 800w, images/18.png 1625w" alt="" class="slider-image"></div>
              </div>
              <div class="w-slide">
                <div class="slide-container"><img src="images/19.png" loading="lazy" sizes="66vw" srcset="images/19-p-500.png 500w, images/19.png 1886w" alt="" class="slider-image"></div>
              </div>
            </div>
            <div class="w-slider-arrow-left">
              <div class="w-icon-slider-left"></div>
            </div>
            <div class="w-slider-arrow-right">
              <div class="w-icon-slider-right"></div>
            </div>
            <div class="w-slider-nav w-round"></div>
          </div>
        </div>
        <div class="section-content is--code is--upside-down">
          <p>C&#x27;est aussi l&#x27;occasion de montrer l&#x27;utilité de l&#x27;équilibreur de charges Kubernetes Load Balancer.<br></p>
          <p>Pour cela, nous allons &quot;scale&quot; notre application pour qu&#x27;elle soit maintenant composée de 3 pods<br></p>
          <div class="copy-embed w-embed"><button class="copy-button" onclick="navigator.clipboard.writeText('kubectl scale deployment veille-app --replicas=3')">Copier la commande</button></div>
          <p>Ensuite, ajoutons une ressource de type &quot;Horizontal Scaler&quot; qui déploiera ou non nos pods en fonction de la charge<em><br></em></p>
          <div class="copy-embed w-embed"><button class="copy-button" onclick="navigator.clipboard.writeText('kubectl autoscale deployment veille-app --cpu-percent=80 --min=1 --max=5')">Copier la commande</button></div>
          <p>Et enfin, nous pouvons exposer notre application !</p>
          <div class="copy-embed w-embed"><button class="copy-button" onclick="navigator.clipboard.writeText('kubectl expose deployment veille-app --name=veille-app-service --type=LoadBalancer --port 80 --target-port 80')">Copier la commande</button></div>
          <p>Le déploiement peut prendre quelques minutes, mais dès lors que l&#x27;External IP est générée (visible en utilisant <span class="redspan"><em>kubectl get service</em></span> ),<br>nous pourrons accéder à notre application !<a href="http://https://example.kubernetes.paul-forsans.fr/" class="in-text__link"></a>
          </p><img src="images/21.png" loading="lazy" sizes="(max-width: 991px) 83vw, 64vw" srcset="images/21-p-500.png 500w, images/21.png 637w" alt="">
        </div>
        <h2 class="code-end">Voilà, notre application Kubernetes est fonctionnelle, et s&#x27;équilibre en fonction de la charge. Si vous voulez voir le résultat, l&#x27;exemple utilisé ici est accessible en dessous.</h2>
        <a href="http://example.kubernetes.paul-forsans.fr" target="_blank" class="copy-button w-button">L&#x27;exemple</a>
      </div>
    </div>
  </div>
  <div class="section">
    <div class="container">
      <div class="separator"></div>
      <div class="footer">
        <div class="footer-content">
          <a href="index.html" class="buttons footer-button">Accueil</a>
          <a href="#" class="buttons footer-button">Conteneurs</a>
          <a href="#" class="buttons footer-button">Orchestrateurs</a>
          <a href="#" class="buttons footer-button">Fonctionnement</a>
        </div>
        <div class="footer-content">
          <a href="code.html" aria-current="page" class="buttons footer-button w--current">Exemple de Code</a>
          <a href="mailto:pro.forsans.paul@gmail.com?subject=Kubernetes" class="buttons footer-button">Me Contacter</a>
          <p class="gke">Ce site tourne actuellement sur un cluster<br>Kubernetes de GKE</p>
        </div>
      </div>
    </div>
  </div>
  <script src="https://d3e54v103j8qbb.cloudfront.net/js/jquery-3.5.1.min.dc5e7f18c8.js?site=61f7bcaf15e4996f07f19373" type="text/javascript" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
  <script src="js/webflow.js" type="text/javascript"></script>
  <!-- [if lte IE 9]><script src="https://cdnjs.cloudflare.com/ajax/libs/placeholders/3.0.2/placeholders.min.js"></script><![endif] -->
</body>
</html>